<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infers epidemic dynamics using viral load data • virosolver</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Infers epidemic dynamics using viral load data">
<meta property="og:description" content="An R package with compiled code to infers incidence curves using input viral load data as Ct values, where the Ct values are generated from random cross-sectional samples. The model much calibrated to the relevant pathogen's viral kinetics following infection.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">virosolver</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/vignette.html">virosolver vignette -- simulated data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="a-method-to-infer-epidemic-dynamics-using-viral-load-data-virosolver" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#a-method-to-infer-epidemic-dynamics-using-viral-load-data-virosolver" class="anchor" aria-hidden="true"></a>A method to infer epidemic dynamics using viral load data: virosolver</h1></div>
<p>This README provides instructions for setup and installation of the <code>virosolver</code> package. A vignette is provided with a simple case study using simulated data to re-estimate the true underlying incidence curve.</p>
<p>Documentation for this package is a work in progress and will seem a little overwhelming to new users. This particular version serves the accompanying <a href="https://doi.org/10.1101/2020.10.08.20204222" class="external-link">paper</a>, with all scripts for the paper found at the git repository at <a href="https://github.com/jameshay218/virosolver_paper" class="external-link uri">https://github.com/jameshay218/virosolver_paper</a>.</p>
<p>A more user-friendly, stripped down version of the package is under development.</p>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor" aria-hidden="true"></a>Setup</h1>
<p>This package relies on the <code>lazymcmc</code> R package, which is used for the MCMC procedure. This is easy to do with <code>devtools::install_github("jameshay218/lazymcmc")</code>. <em>However</em>, for many analyses where multi-modal posteriors are suspected, a separate branch implementing parallel tempering is needed. I’d recommend you set this up as follows: - Install the <code>lazymcmc</code> base package using <code><a href="https://devtools.r-lib.org//reference/remote-reexports.html" class="external-link">devtools::install_github</a></code> as above. Any time this version is used, <code><a href="https://github.com/jameshay218/lazymcmc" class="external-link">library(lazymcmc)</a></code> is called. - Clone the <code>parallel_tempering</code> branch from <a href="https://github.com/jameshay218/lazymcmc/tree/parallel_tempering" class="external-link">here</a>. Whenever this version is needed, then <code>devtools::load_all("PATH TO LAZYMCMC PARALLEL TEMPERING REPO")</code> is called instead.</p>
<p>It is possible to install the parallel tempering branch directly with <code>devtools::load_all("jameshay218/lazymcmc",ref="parallel_tempering")</code>, but I prefer to load the package locally until I merge the parallel tempering and master branches.</p>
<p>A number of generic R packages are also used throughout:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tidyverse"</span>,<span class="st">"ggthemes"</span>,<span class="st">"ggpubr"</span>,<span class="st">"ggsci"</span>,<span class="st">"data.table"</span>,<span class="st">"patchwork"</span>,
<span class="st">"fitdistrplus"</span>,<span class="st">"deSolve"</span>,<span class="st">"lazymcmc"</span>,<span class="st">"odin"</span>,<span class="st">"doParallel"</span>,<span class="st">"coda"</span><span class="op">)</span></code></pre></div>
<p>Finally, this code uses compiled code with Rcpp, so you’ll need a C++ compiler (Rtools on Windows, Xcode on Mac). See <a href="http://adv-r.had.co.nz/Rcpp.html" class="external-link">here</a>.</p>
</div>
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor" aria-hidden="true"></a>Getting started</h1>
<p>The best way to get started is to <strong>read the accompanying vignette</strong>, which takes you through the process of using <code>virosolver</code> step by step.</p>
<p><a href="https://jameshay218.github.io/virosolver/inst/doc/vignette.html" class="external-link">The vignette can be found here.</a></p>
<p>Below is a snippet of code providing the absolute minimum R calls needed to get the MCMC framework up and running. I would <em>strongly</em> advise that you use the vignette instead and read the accompanying <a href="https://doi.org/10.1101/2020.10.08.20204222" class="external-link">paper</a> to avoid making early mistakes or getting started with flawed assumptions.</p>
<p>First, setup up all of the libraries and attach the example data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">virosolver</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jameshay218/lazymcmc" class="external-link">lazymcmc</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="co">## Attach simulated data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_ct_data</span><span class="op">)</span>

<span class="co">## Attach parameter table for MCMC control</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_gp_partab</span><span class="op">)</span></code></pre></div>
<p>Next, we define priors, resize the Markov chain Monte Carlo (MCMC) control table and set the MCMC chain length.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Re-size the parameter control table to fit the data dimensions</span>
<span class="co">## This is for the GP version</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">example_ct_data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">times</span>, each<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span>
<span class="va">t_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">mat</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">-</span><span class="va">times</span><span class="op">)</span><span class="op">)</span> <span class="co">## precomputed table of pairwise distances in time, used for the Gaussian process prior</span>
<span class="va">par_tab</span> <span class="op">&lt;-</span> <span class="va">example_gp_partab</span>
<span class="va">par_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">par_tab</span><span class="op">[</span><span class="va">par_tab</span><span class="op">$</span><span class="va">names</span> <span class="op">!=</span> <span class="st">"prob"</span>,<span class="op">]</span>, <span class="va">par_tab</span><span class="op">[</span><span class="va">par_tab</span><span class="op">$</span><span class="va">names</span> <span class="op">==</span> <span class="st">"prob"</span>,<span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span>
<span class="va">pars</span> <span class="op">&lt;-</span> <span class="va">par_tab</span><span class="op">$</span><span class="va">values</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">par_tab</span><span class="op">$</span><span class="va">names</span>

<span class="co">## Pull out the current values for each parameter, and set these as the prior means</span>
<span class="va">means</span> <span class="op">&lt;-</span> <span class="va">par_tab</span><span class="op">$</span><span class="va">values</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">par_tab</span><span class="op">$</span><span class="va">names</span>

<span class="co">## Set standard deviations of prior distribution</span>
<span class="va">sds_gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"obs_sd"</span><span class="op">=</span><span class="fl">0.5</span>,<span class="st">"viral_peak"</span><span class="op">=</span><span class="fl">2</span>,
         <span class="st">"wane_rate2"</span><span class="op">=</span><span class="fl">1</span>,<span class="st">"t_switch"</span><span class="op">=</span><span class="fl">3</span>,<span class="st">"level_switch"</span><span class="op">=</span><span class="fl">1</span>,
         <span class="st">"prob_detect"</span><span class="op">=</span><span class="fl">0.03</span>,
         <span class="st">"incubation"</span><span class="op">=</span><span class="fl">0.25</span>, <span class="st">"infectious"</span><span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>

<span class="co">## Define a function that returns the log prior probability for a given vector of parameter</span>
<span class="co">## values in `pars`, given the prior means and standard deviations set above.</span>
<span class="co">## Prior for GP version</span>
<span class="va">prior_func_gp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  <span class="va">par_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span>
  
  <span class="co">## Viral kinetics parameters</span>
  <span class="va">obs_sd_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"obs_sd"</span><span class="op">]</span>, <span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"obs_sd"</span><span class="op">)</span><span class="op">]</span>, <span class="va">sds_gp</span><span class="op">[</span><span class="st">"obs_sd"</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">viral_peak_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"viral_peak"</span><span class="op">]</span>, <span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"viral_peak"</span><span class="op">)</span><span class="op">]</span>, <span class="va">sds_gp</span><span class="op">[</span><span class="st">"viral_peak"</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">wane_2_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"wane_rate2"</span><span class="op">]</span>,<span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"wane_rate2"</span><span class="op">)</span><span class="op">]</span>,<span class="va">sds_gp</span><span class="op">[</span><span class="st">"wane_rate2"</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">tswitch_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"t_switch"</span><span class="op">]</span>,<span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"t_switch"</span><span class="op">)</span><span class="op">]</span>,<span class="va">sds_gp</span><span class="op">[</span><span class="st">"t_switch"</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">level_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"level_switch"</span><span class="op">]</span>,<span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"level_switch"</span><span class="op">)</span><span class="op">]</span>,<span class="va">sds_gp</span><span class="op">[</span><span class="st">"level_switch"</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">beta1_mean</span> <span class="op">&lt;-</span> <span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"prob_detect"</span><span class="op">)</span><span class="op">]</span>
  <span class="va">beta1_sd</span> <span class="op">&lt;-</span> <span class="va">sds_gp</span><span class="op">[</span><span class="st">"prob_detect"</span><span class="op">]</span>
  <span class="va">beta_alpha</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">beta1_mean</span><span class="op">)</span><span class="op">/</span><span class="va">beta1_sd</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="va">beta1_mean</span><span class="op">)</span><span class="op">*</span><span class="va">beta1_mean</span><span class="op">^</span><span class="fl">2</span>
  <span class="va">beta_beta</span> <span class="op">&lt;-</span> <span class="va">beta_alpha</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">beta1_mean</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">beta_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"prob_detect"</span><span class="op">]</span>,<span class="va">beta_alpha</span>,<span class="va">beta_beta</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co">#########</span>
  <span class="co">## IMPORTANT</span>
  <span class="co">## Gaussian process prior, un-centered version</span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">pars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">par_names</span><span class="op">==</span><span class="st">"prob"</span><span class="op">)</span><span class="op">]</span>
  <span class="co">## Leave this - correct for uncentered version as per Chapter 14 Statistical Rethinking</span>
  <span class="va">prob_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">k</span>, <span class="fl">0</span>, <span class="fl">1</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
  <span class="co">#########</span>
  
  <span class="va">nu_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"nu"</span><span class="op">]</span>, <span class="fl">1</span><span class="op">/</span><span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"nu"</span><span class="op">)</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">rho_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">pars</span><span class="op">[</span><span class="st">"rho"</span><span class="op">]</span>, <span class="fl">1</span><span class="op">/</span><span class="va">means</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span> <span class="op">==</span> <span class="st">"rho"</span><span class="op">)</span><span class="op">]</span>,log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="va">obs_sd_prior</span> <span class="op">+</span> <span class="va">viral_peak_prior</span> <span class="op">+</span> <span class="va">wane_2_prior</span> <span class="op">+</span> <span class="va">tswitch_prior</span> <span class="op">+</span>
    <span class="va">level_prior</span> <span class="op">+</span> <span class="va">beta_prior</span> <span class="op">+</span> <span class="va">prob_priors</span> <span class="op">+</span>
    <span class="va">nu_prior</span> <span class="op">+</span> <span class="va">rho_prior</span>
<span class="op">}</span>

<span class="co">## MCMC chain options</span>
<span class="va">mcmc_pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iterations"</span><span class="op">=</span><span class="fl">200000</span>,<span class="st">"popt"</span><span class="op">=</span><span class="fl">0.44</span>,<span class="st">"opt_freq"</span><span class="op">=</span><span class="fl">2000</span>,
                    <span class="st">"thin"</span><span class="op">=</span><span class="fl">100</span>,<span class="st">"adaptive_period"</span><span class="op">=</span><span class="fl">100000</span>,<span class="st">"save_block"</span><span class="op">=</span><span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p>Run the MCMC framework.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lazymcmc/man/run_MCMC.html" class="external-link">run_MCMC</a></span><span class="op">(</span>parTab<span class="op">=</span><span class="va">par_tab</span>,
                     data<span class="op">=</span><span class="va">example_ct_data</span>,
                     INCIDENCE_FUNC<span class="op">=</span><span class="va">gaussian_process_model</span>,
                     PRIOR_FUNC<span class="op">=</span><span class="va">prior_func_gp</span>,
                     mcmcPars<span class="op">=</span><span class="va">mcmc_pars</span>,
                     filename<span class="op">=</span><span class="st">"example"</span>,
                     CREATE_POSTERIOR_FUNC<span class="op">=</span><span class="va">create_posterior_func</span>,
                     mvrPars<span class="op">=</span><span class="cn">NULL</span>,
                     OPT_TUNING<span class="op">=</span><span class="fl">0.2</span>,
                     use_pos<span class="op">=</span><span class="cn">FALSE</span>,
                     t_dist<span class="op">=</span><span class="va">t_dist</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">file</span><span class="op">)</span></code></pre></div>
<p>Finally, read in the MCMC chain and use a pre-built function to compare the estimated incidence curve to the true incidence curve (blue line) from the simulated data. In practice you should run multiple chains and check for convergence, as in the vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"example_univariate_chain.csv"</span><span class="op">)</span>
<span class="va">chain</span> <span class="op">&lt;-</span> <span class="va">chain</span><span class="op">[</span><span class="va">chain</span><span class="op">$</span><span class="va">sampno</span> <span class="op">&gt;</span> <span class="va">mcmc_pars</span><span class="op">[</span><span class="st">"adaptive_period"</span><span class="op">]</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">example_seir_incidence</span><span class="op">)</span>
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">plot_prob_infection</span><span class="op">(</span><span class="va">chain</span>,nsamps<span class="op">=</span><span class="fl">200</span>, INCIDENCE_FUNC<span class="op">=</span><span class="va">gaussian_process_model</span>,
                                  solve_times<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">example_ct_data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,obs_dat<span class="op">=</span><span class="va">example_ct_data</span>,
                                  true_prob_infection<span class="op">=</span><span class="va">example_seir_incidence</span>,smooth<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">p_incidence_prediction</span> <span class="op">&lt;-</span> <span class="va">predictions</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">185</span><span class="op">)</span><span class="op">)</span>
<span class="va">p_incidence_prediction</span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-5-1.png"><!-- --></p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>


<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>James Hay <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-1998-1844" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://zenodo.org/badge/latestdoi/301812162" class="external-link"><img src="https://zenodo.org/badge/301812162.svg" alt="DOI"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#maturing" class="external-link"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="Lifecycle: maturing"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by James Hay.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
